import requests
import time

# Step 1: Request device and user codes
response = requests.post("https://www.seedr.cc/api/device/code?client_id=seedr_xbmc")
data = response.json()
device_code = data['device_code']
user_code = data['user_code']
verification_url = data['verification_url']
interval = data.get('interval', 5)

# Step 2: Prompt user to authorize
print(f"Please visit {verification_url} and enter the code: {user_code}")

# Step 3: Poll for authorization
token = None
while not token:
    time.sleep(interval)
    token_response = requests.post("https://www.seedr.cc/api/device/token", data={
        'client_id': 'seedr_xbmc',
        'device_code': device_code,
        'grant_type': 'urn:ietf:params:oauth:grant-type:device_code'
    })
    if token_response.status_code == 200:
        token = token_response.json()['access_token']
    elif token_response.status_code == 400:
        error = token_response.json().get('error')
        if error != 'authorization_pending':
            raise Exception(f"Authorization failed: {error}")
    else:
        raise Exception(f"Unexpected response: {token_response.status_code}")

print(f"Access token obtained: {token}")
